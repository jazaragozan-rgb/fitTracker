<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>fitTracker - Autenticación</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a7fb9">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <section id="auth">
    <form id="form-login" onsubmit="return false;">
      <h3><span style="font-weight: bold;color: rgb(0, 0, 0);">INICIAR SESIÓN</span></h3>
      <input id="log-email" type="email" placeholder="Email" required>
      <input id="log-pass" type="password" placeholder="Contraseña" required>
      <button type="button" id="btnLogin">Entrar</button>
      <button type="button" id="showRegisterBtn">Crear cuenta nueva</button>
      <div id="log-msg" class="hint"></div>
    </form>

    <form id="form-register" class="hidden" onsubmit="return false;">
      <h3><span style="font-weight: bold;color: rgb(0, 0, 0);">REGISTRO</span></h3>
      <input id="reg-email" type="email" placeholder="Email" required>
      <input id="reg-pass" type="password" placeholder="Contraseña (mín. 6 caracteres)" minlength="6" required>
      <input id="reg-pass2" type="password" placeholder="Repite la contraseña" minlength="6" required>
      <button type="button" id="btnRegister">Crear cuenta</button>
      <button type="button" id="showLoginBtn">Ya tengo cuenta</button>
      <div id="reg-msg" class="hint"></div>
    </form>
  </section>

  <script>
    console.log('[auth.html] Script inline cargado');

    document.addEventListener('DOMContentLoaded', function() {
      console.log('[auth.html] DOMContentLoaded - Inicializando toggle');

      const formLogin = document.getElementById('form-login');
      const formRegister = document.getElementById('form-register');
      const showRegisterBtn = document.getElementById('showRegisterBtn');
      const showLoginBtn = document.getElementById('showLoginBtn');

      console.log('[auth.html] Elementos encontrados:', {
        formLogin: !!formLogin,
        formRegister: !!formRegister,
        showRegisterBtn: !!showRegisterBtn,
        showLoginBtn: !!showLoginBtn
      });

      if (showRegisterBtn) {
        showRegisterBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          formLogin.classList.add('hidden');
          formRegister.classList.remove('hidden');
          const logMsg = document.getElementById('log-msg');
          if (logMsg) logMsg.textContent = '';
        });
      }

      if (showLoginBtn) {
        showLoginBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          formRegister.classList.add('hidden');
          formLogin.classList.remove('hidden');
          const regMsg = document.getElementById('reg-msg');
          if (regMsg) regMsg.textContent = '';
        });
      }
    });

    // ==================== SERVICE WORKER ====================
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').then(reg => {
        console.log('[PWA] SW registrado en auth');
        reg.update();

        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'activated') {
              window.location.reload();
            }
          });
        });
      }).catch(err => console.error('[PWA] Error SW:', err));

      navigator.serviceWorker.addEventListener('message', event => {
        if (event.data?.type === 'SW_UPDATED') {
          window.location.reload();
        }
      });
    }
  </script>

  <!-- Módulo auth.js se carga DESPUÉS (para las funciones de Firebase) -->
  <script type="module" src="auth.js"></script>
</body>
</html>